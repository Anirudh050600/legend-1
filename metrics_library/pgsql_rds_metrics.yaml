data_source: Cloudwatch
reference: https://aws.amazon.com/rds/postgresql/
description: USE-RED metrics for Postgres RDS
panels:
  - title: (U) CPU Utilization Percentage
    type: Graph
    description: The percentage of CPU utilization.
    targets:
      {% for dimension in data %}
    - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
      metric: CPUUtilization
      namespace: AWS/RDS
      statistic: Maximum
      alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      {% endfor %}
    alert_config:
      priority: P3
      message: 'CPU Utilisation is High'
      rule:
        for_duration: 10m
        evaluate_every: 1m
      conditions:
        - evaluator_params: 60 
          evaluator_type: gt
          operator_type: and
          query_ref_id: A # it is according to sequence
          query_time_end: now
          query_time_start: 5m
          reducer_params: []
          reducer_type: avg

  - title: (U) Database Connection Count
    type: Graph
    description: The number of database connections in use
    targets:
      {% for dimension in data %}
    - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
      metric: DatabaseConnections
      namespace: AWS/RDS
      statistic: Maximum
      alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      {% endfor %}

  - title: (U) Freeable Memory
    type: Graph
    description: The amount of available random access memory. (For MariaDB, MySQL, Oracle, and PostgreSQL DB instances, this metric reports the value of the MemAvailable field of /proc/meminfo)
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: FreeableMemory
        namespace: AWS/RDS
        statistic: Average
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (U) Network Throughput (Bytes)
    type: Graph
    description: The incoming (Receive|Transmit) network traffic on the DB instance, including both customer database traffic and Amazon RDS traffic used for monitoring and replication
    targets:
      {% for dimension in data %}
    - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
      metric: NetworkReceiveThroughput
      namespace: AWS/RDS
      statistic: Maximum
      alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
    - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
      metric: NetworkTransmitThroughput
      namespace: AWS/RDS
      statistic: Maximum
      alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      {% endfor %}

  - title: (U) Read/Write IOPS 
    type: Graph
    description: The average number of disk read/write I/O operations per second 
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: ReadIOPS
        namespace: AWS/RDS
        statistic: Maximum
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: WriteIOPS
        namespace: AWS/RDS
        statistic: Maximum
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      {% endfor %}

  - title: (U) Free Storage Space
    type: Graph
    description: The amount of available storage space
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: FreeStorageSpace
        namespace: AWS/RDS
        statistic: Maximum 
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (U) Transaction Log Disk Usage
    type: Graph
    description: The disk space used by transaction logs. Applies to PostgreSQL.
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: TransactionLogsDiskUsage
        namespace: AWS/RDS
        statistic: Maximum 
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (S) Disk Queue Depth
    type: Graph
    description: The number of outstanding IOs (read/write requests) waiting to access the disk.
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: DiskQueueDepth
        namespace: AWS/RDS
        statistic: Average
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (S) Swap Usage 
    type: Graph
    description: The amount of swap space used on the DB instance. 
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: SwapUsage 
        namespace: AWS/RDS
        statistic: Average
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (D) Read/Write latency
    type: Graph
    description: The maximum amount of time taken per disk read/write I/O operation.
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: ReadLatency
        namespace: AWS/RDS
        statistic: Maximum
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: WriteLatency
        namespace: AWS/RDS
        statistic: Maximum
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
      {% endfor %}

  - title: (D) Replication Lag (Only for read replicas)
    type: Graph
    description: The max amount of time a Read Replica DB instance lags behind the source DB instance. 
    targets:
      {% for dimension in data %}
      - dimensions: {"DBInstanceIdentifier": {{ dimension.db_instance_identifier }}}
        metric: ReplicaLag
        namespace: AWS/RDS
        statistic: Maximum
        alias: '{{ '{{DBInstanceIdentifier}}_{{metric}}_{{stat}}' }}'
        {% endfor %}

  - title: (D) Slow Query Count
    type: Graph
    description: No of slow queries 
    targets:
      {% for dimension in data %}
      - dimensions: {}
        metric: SlowQueryCount-{{ dimension.db_instance_identifier }}
        namespace: RDSCustomMetric
        statistic: Maximum
        {% endfor %}

  - title: (E) Replication error count (Only for read replica)
    type: Graph
    description: Replication related errors from logs (Custom Metric)  
    targets:
      {% for dimension in data %}
      - dimensions: {}
        metric: ReplicationErrorCount-{{ dimension.db_instance_identifier }}
        namespace: RDSCustomMetric
        statistic: Maximum
        {% endfor %}


